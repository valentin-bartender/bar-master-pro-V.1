<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bar Master Pro: Elite Edition</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { font-family: 'Segoe UI', sans-serif; background: #0a0a0a; color: #fff; height: 100vh; overflow: hidden; }
        .container { display: flex; flex-direction: column; height: 100vh; }
        .screen { display: none; height: 100%; justify-content: center; align-items: center; }
        .screen.active { display: flex; flex-direction: column; }
        
        /* –ú–µ–Ω—é */
        #screen-menu { background: radial-gradient(circle, #1e1b4b 0%, #000 100%); }
        .menu-card { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; border: 1px solid #22d3ee; text-align: center; width: 90%; max-width: 400px; }
        .mode-btn { width: 100%; padding: 16px; margin: 10px 0; border: 1px solid #22d3ee; background: transparent; color: #22d3ee; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.3s; }
        .mode-btn:hover { background: #22d3ee; color: #000; box-shadow: 0 0 20px #22d3ee; }

        /* –ò–≥—Ä–∞ */
        .header { background: #111; padding: 10px 15px; border-bottom: 2px solid #22d3ee; display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .stat-box { padding: 5px 10px; border-radius: 6px; border: 1px solid #22d3ee; font-size: 12px; background: rgba(34, 211, 238, 0.1); }
        .main-layout { display: flex; flex: 1; width: 100%; overflow: hidden; }
        .game-area { width: 70%; padding: 15px; overflow-y: auto; background: #0f1115; }
        .side-panel { width: 30%; background: #111; padding: 15px; border-left: 1px solid #333; display: flex; flex-direction: column; gap: 10px; }

        /* –ö–Ω–æ–ø–∫–∏ –∏ –ø–ª–∏—Ç–∫–∏ */
        .grid-select { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 8px; margin-bottom: 15px; }
        .select-btn { padding: 10px; background: #1a1a1a; border: 1px solid #444; color: #fff; border-radius: 6px; cursor: pointer; font-size: 10px; }
        .select-btn.active { border-color: #f472b6; background: rgba(244, 114, 182, 0.2); }
        .bottles-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; }
        .bottle-card { background: #1a1a1a; padding: 8px; border-radius: 6px; text-align: center; border: 1px solid #333; }
        .pour-btn { background: #333; border: none; color: #22d3ee; padding: 4px 8px; font-size: 10px; cursor: pointer; border-radius: 4px; margin-top: 4px; }
        .finish-btn { width: 100%; padding: 15px; border-radius: 8px; background: #10b981; color: #fff; font-weight: bold; border: none; cursor: pointer; margin-top: 10px; }
        
        /* –§–∏–¥–±—ç–∫ */
        .feedback-box { flex: 1; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; font-size: 11px; overflow-y: auto; border: 1px solid #333; }
        .hint-overlay { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1a; border: 2px solid #ffd700; padding: 20px; border-radius: 12px; z-index: 1000; display: none; white-space: pre-line; box-shadow: 0 0 60px #000; }
        
        .controls-footer { position: fixed; bottom: 20px; left: 20px; display: flex; gap: 12px; }
        .float-btn { width: 45px; height: 45px; border-radius: 50%; background: #222; border: 1px solid #22d3ee; color: #fff; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="screen-menu" class="screen active">
        <div class="menu-card">
            <h1 style="color:#22d3ee; margin-bottom:15px; font-size: 24px;">BAR MASTER</h1>
            <button class="mode-btn" onclick="startGame('work', 180)">–°–ú–ï–ù–ê (3 –ú–ò–ù)</button>
            <button class="mode-btn" onclick="startGame('work', 300)">–°–ú–ï–ù–ê (5 –ú–ò–ù)</button>
            <button class="mode-btn" onclick="startGame('marathon')">–ú–ê–†–ê–§–û–ù (–ú–ï–ù–Æ)</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="header">
            <div class="stat-box">‚è±Ô∏è <span id="timer">00:00</span></div>
            <div class="stat-box" style="color:#f472b6">–ó–ê–ö–ê–ó: <b id="order-name">---</b></div>
            <div class="stat-box">‚≠ê <span id="score-counter">0/0</span></div>
        </div>
        <div class="main-layout">
            <div class="game-area">
                <div id="step-1">
                    <p style="color:#22d3ee; font-size:12px; margin-bottom:10px;">–ë–û–ö–ê–õ –ò –ú–ï–¢–û–î</p>
                    <div class="grid-select" id="glass-grid"></div>
                    <div class="grid-select" id="tool-grid"></div>
                    <button class="finish-btn" onclick="changeStep(2)">–ö –ò–ù–ì–†–ï–î–ò–ï–ù–¢–ê–ú</button>
                </div>
                <div id="step-2" class="hidden">
                    <div id="tabs-bar" style="margin-bottom:10px; display:flex; gap:5px; overflow-x:auto;"></div>
                    <div id="bottles-grid" class="bottles-grid"></div>
                    <div style="margin-top:10px; padding:8px; background:#222; border-radius:4px; font-size:11px;">
                        –°–û–°–¢–ê–í: <span id="current-mix" style="color:#22d3ee">–ü—É—Å—Ç–æ</span>
                    </div>
                    <button class="finish-btn" onclick="changeStep(3)">–ö –ì–ê–†–ù–ò–†–£</button>
                </div>
                <div id="step-3" class="hidden">
                    <p style="color:#22d3ee; font-size:12px; margin-bottom:10px;">–ì–ê–†–ù–ò–† –ò –ü–û–î–ê–ß–ê</p>
                    <div class="grid-select" id="garnish-grid"></div>
                </div>
            </div>
            <div class="side-panel">
                <p style="font-size:10px; color:#888;">–û–®–ò–ë–ö–ò:</p>
                <div class="feedback-box" id="live-feedback"></div>
                <button onclick="resetMix()" style="padding:8px; background:#431407; border:none; color:white; border-radius:4px; cursor:pointer; font-size:10px;">–°–ë–†–û–°–ò–¢–¨</button>
            </div>
        </div>
    </div>
</div>

<div id="hint-box" class="hint-overlay"></div>
<div class="controls-footer">
    <button class="float-btn" onclick="toggleHint()" title="–ü–æ–¥—Å–∫–∞–∑–∫–∞">üí°</button>
    <button class="float-btn" onclick="toggleMusic()" title="–ú—É–∑—ã–∫–∞">üéµ</button>
</div>

<audio id="audio-player" loop src="music.mp3"></audio>

<script>
    const recipes = {
        // –®–û–¢–´
        "B-52": { ing: {"–ë–µ–π–ª–∏—Å":20, "–ö–æ—Ñ–µ–π–Ω—ã–π –ª–∏–∫–µ—Ä":20, "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –ª–∏–∫–µ—Ä":20}, glass: "Shot", tool: "Layered", g: ["–ù–µ—Ç"] },
        "Uncle Bob": { ing: {"–í–æ–¥–∫–∞":30, "–°–∏—Ä–æ–ø –ì—Ä–µ–Ω–∞–¥–∏–Ω":10, "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫":10}, glass: "Shot", tool: "Shaker", g: ["–ù–µ—Ç"] },
        "The Green Mile": { ing: {"–î—ã–Ω–Ω—ã–π –ª–∏–∫–µ—Ä":20, "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –ª–∏–∫–µ—Ä":20, "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫":10}, glass: "Shot", tool: "Shaker", g: ["–ù–µ—Ç"] },
        "Fumari set": { ing: {"–í–æ–¥–∫–∞":80, "–ê–Ω–∞–Ω–∞—Å–æ–≤—ã–π —Å–æ–∫":40, "–°–∏—Ä–æ–ø –ú–∞—Ä–∞–∫—É–π—è":20, "–ú–µ–¥":10, "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫":10}, glass: "Shot", tool: "Shaker", g: ["–ù–µ—Ç"] },
        "Scittles set": { ing: {"–í–æ–¥–∫–∞":120, "–°–∏—Ä–æ–ø –ö–∏–≤–∏":20, "–ö–æ–∫–æ—Å–æ–≤—ã–π —Å–∏—Ä–æ–ø":20, "–°–∏—Ä–æ–ø –ú–∞–Ω–≥–æ":20}, glass: "Shot", tool: "Shaker", g: ["–ù–µ—Ç"] },
        
        // –ö–õ–ê–°–°–ò–ö–ê LONG
        "Sex on the beach": { ing: {"–í–æ–¥–∫–∞":40, "–ü–µ—Ä—Å–∏–∫–æ–≤—ã–π –ª–∏–∫–µ—Ä":20, "–ö–ª—é–∫–≤–µ–Ω–Ω—ã–π –º–æ—Ä—Å":40, "–ê–Ω–∞–Ω–∞—Å–æ–≤—ã–π —Å–æ–∫":40}, glass: "Highball", tool: "Build", g: ["–ê–ø–µ–ª—å—Å–∏–Ω"] },
        "Aperol Spritz": { ing: {"–ê–ø–µ—Ä–æ–ª—å":60, "–ò–≥—Ä–∏—Å—Ç–æ–µ –≤–∏–Ω–æ":90, "–°–æ–¥–æ–≤–∞—è":30}, glass: "Wine Glass", tool: "Build", g: ["–ê–ø–µ–ª—å—Å–∏–Ω"] },
        "Cuba Libre": { ing: {"–ó–æ–ª–æ—Ç–æ–π —Ä–æ–º":50, "–ü–µ–ø—Å–∏":120, "–õ–∞–π–º":10}, glass: "Highball", tool: "Build", g: ["–õ–∞–π–º"] },
        "Long Island Iced Tea": { ing: {"–í–æ–¥–∫–∞":15, "–†–æ–º":15, "–¢–µ–∫–∏–ª–∞":15, "–î–∂–∏–Ω":15, "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –ª–∏–∫–µ—Ä":15, "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫":20, "–ü–µ–ø—Å–∏":50}, glass: "Highball", tool: "Build", g: ["–õ–∏–º–æ–Ω"] },
        
        // –§–ò–†–ú–ï–ù–ù–´–ï
        "Sky Cloud": { ing: {"–†–æ–º":40, "–ê–Ω–∞–Ω–∞—Å–æ–≤—ã–π —Å–æ–∫":40, "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π —Å–æ–∫":40, "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –ª–∏–∫–µ—Ä":15, "–°–∏—Ä–æ–ø –ë–ª—é –ö—É—Ä–∞—Å–∞–æ":10, "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫":10}, glass: "Highball", tool: "Shaker", g: ["–ù–µ—Ç"] },
        "Banana Papa": { ing: {"–î–∂–∏–Ω":40, "–ë–∞–Ω–∞–Ω":30, "–ü–µ—Ä—Å–∏–∫–æ–≤—ã–π —Å–æ–∫":60, "–°–æ–¥–æ–≤–∞—è":40}, glass: "Highball", tool: "Build", g: ["–ë–∞–Ω–∞–Ω"] },
        "Sky Mai Tai": { ing: {"–†–æ–º":30, "–ó–æ–ª–æ—Ç–æ–π —Ä–æ–º":30, "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –ª–∏–∫–µ—Ä":15, "–ê–Ω–∞–Ω–∞—Å–æ–≤—ã–π —Å–æ–∫":40, "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π —Å–æ–∫":40, "–ú–∏–Ω–¥–∞–ª—å–Ω—ã–π —Å–∏—Ä–æ–ø":10, "–°–∏—Ä–æ–ø –ì—Ä–µ–Ω–∞–¥–∏–Ω":5, "–õ–∞–π–º":10}, glass: "Highball", tool: "Shaker", g: ["–õ–∞–π–º"] },
        
        // –ë/–ê
        "Pina Colada Lite": { ing: {"–ê–Ω–∞–Ω–∞—Å–æ–≤—ã–π —Å–æ–∫":100, "–ú–æ–ª–æ–∫–æ":50, "–ö–æ–∫–æ—Å–æ–≤—ã–π —Å–∏—Ä–æ–ø":20, "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫":10}, glass: "Hurricane", tool: "Shaker", g: ["–ê–Ω–∞–Ω–∞—Å"] },
        "Lemonade Kiwi": { ing: {"–ö–∏–≤–∏":20, "–°–∏—Ä–æ–ø –ú–∞—Ä–∞–∫—É–π—è":10, "–°–æ–¥–æ–≤–∞—è":150, "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫":10}, glass: "Highball", tool: "Build", g: ["–ù–µ—Ç"] }
    };

    const ingredients = {
        "–ê–ª–∫–æ–≥–æ–ª—å": ["–í–æ–¥–∫–∞", "–†–æ–º", "–ó–æ–ª–æ—Ç–æ–π —Ä–æ–º", "–î–∂–∏–Ω", "–¢–µ–∫–∏–ª–∞", "–ò–≥—Ä–∏—Å—Ç–æ–µ –≤–∏–Ω–æ"],
        "–õ–∏–∫–µ—Ä—ã": ["–ë–µ–π–ª–∏—Å", "–ö–æ—Ñ–µ–π–Ω—ã–π –ª–∏–∫–µ—Ä", "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –ª–∏–∫–µ—Ä", "–î—ã–Ω–Ω—ã–π –ª–∏–∫–µ—Ä", "–ü–µ—Ä—Å–∏–∫–æ–≤—ã–π –ª–∏–∫–µ—Ä", "–ê–ø–µ—Ä–æ–ª—å"],
        "–°–∏—Ä–æ–ø—ã": ["–°–∏—Ä–æ–ø –ì—Ä–µ–Ω–∞–¥–∏–Ω", "–°–∏—Ä–æ–ø –ë–ª—é –ö—É—Ä–∞—Å–∞–æ", "–ö–æ–∫–æ—Å–æ–≤—ã–π —Å–∏—Ä–æ–ø", "–ú–∏–Ω–¥–∞–ª—å–Ω—ã–π —Å–∏—Ä–æ–ø", "–°–∏—Ä–æ–ø –ú–∞—Ä–∞–∫—É–π—è", "–°–∏—Ä–æ–ø –ú–∞–Ω–≥–æ", "–°–∏—Ä–æ–ø –ö–∏–≤–∏", "–ú–µ–¥"],
        "–°–æ–∫–∏/–ú–∏–∫—Å—ã": ["–ê–Ω–∞–Ω–∞—Å–æ–≤—ã–π —Å–æ–∫", "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π —Å–æ–∫", "–ü–µ—Ä—Å–∏–∫–æ–≤—ã–π —Å–æ–∫", "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫", "–ö–ª—é–∫–≤–µ–Ω–Ω—ã–π –º–æ—Ä—Å", "–°–æ–¥–æ–≤–∞—è", "–ü–µ–ø—Å–∏", "–ú–æ–ª–æ–∫–æ"],
        "–°–≤–µ–∂–µ–µ": ["–õ–∞–π–º", "–ú—è—Ç–∞", "–ë–∞–Ω–∞–Ω", "–ö–∏–≤–∏", "–ê–ø–µ–ª—å—Å–∏–Ω", "–õ–∏–º–æ–Ω", "–ê–Ω–∞–Ω–∞—Å"]
    };

    const config = {
        glasses: ["Shot", "Highball", "Martini Glass", "Margarita Glass", "Hurricane", "Wine Glass"],
        tools: ["Build", "Shaker", "Layered", "Muddle"],
        garnishes: ["–ù–µ—Ç", "–õ–∞–π–º", "–ú—è—Ç–∞", "–ê–ø–µ–ª—å—Å–∏–Ω", "–õ–∏–º–æ–Ω", "–ê–Ω–∞–Ω–∞—Å", "–ë–∞–Ω–∞–Ω"]
    };

    let state = { mode:'', time:0, interval:null, orders:[], currentIdx:0, build:{ing:{}, glass:'', tool:''}, score:0, history:[] };

    function startGame(mode, sec=0) {
        state = { mode, time:sec, interval:null, orders:Object.keys(recipes).sort(()=>Math.random()-0.5), currentIdx:0, build:{ing:{}, glass:'', tool:''}, score:0, history:[] };
        document.getElementById('screen-menu').classList.remove('active');
        document.getElementById('screen-game').classList.add('active');
        renderUI();
        loadOrder();
        if(mode === 'work') startTimer();
    }

    function renderUI() {
        document.getElementById('glass-grid').innerHTML = config.glasses.map(g => `<button class="select-btn" onclick="setAttr('glass','${g}',this)">${g}</button>`).join('');
        document.getElementById('tool-grid').innerHTML = config.tools.map(t => `<button class="select-btn" onclick="setAttr('tool','${t}',this)">${t}</button>`).join('');
        document.getElementById('garnish-grid').innerHTML = config.garnishes.map(g => `<button class="select-btn" onclick="submit('${g}')">${g}</button>`).join('');
        const tabs = Object.keys(ingredients);
        document.getElementById('tabs-bar').innerHTML = tabs.map(t => `<button class="select-btn" style="white-space:nowrap" onclick="renderBottles('${t}')">${t}</button>`).join('');
        renderBottles(tabs[0]);
    }

    function loadOrder() {
        const name = state.orders[state.currentIdx];
        document.getElementById('order-name').innerText = name;
        document.getElementById('score-counter').innerText = `${state.score}/${state.orders.length}`;
        const r = recipes[name];
        let h = `<b>${name}</b>\n\n`;
        for(let [i,v] of Object.entries(r.ing)) h += `‚Ä¢ ${i}: ${v}ml\n`;
        h += `\n–ë–æ–∫–∞–ª: ${r.glass}\n–ú–µ—Ç–æ–¥: ${r.tool}`;
        document.getElementById('hint-box').innerHTML = h;
        resetMix();
        changeStep(1);
    }

    function submit(g) {
        const target = recipes[state.orders[state.currentIdx]];
        const build = state.build;
        let errs = [];
        if(build.glass !== target.glass) errs.push(`–ë–æ–∫–∞–ª: –Ω—É–∂–µ–Ω ${target.glass}`);
        if(build.tool !== target.tool) errs.push(`–ú–µ—Ç–æ–¥: –Ω—É–∂–µ–Ω ${target.tool}`);
        if(!target.g.includes(g)) errs.push(`–ì–∞—Ä–Ω–∏—Ä: –Ω—É–∂–µ–Ω ${target.g[0]}`);
        for(let [i,v] of Object.entries(target.ing)) if((build.ing[i]||0) !== v) errs.push(`${i}: –Ω–∞–ª–∏—Ç–æ ${build.ing[i]||0}/${v}`);

        const log = document.getElementById('live-feedback');
        if(errs.length === 0) { state.score++; log.innerHTML = `<p style="color:#10b981">‚úÖ ${state.orders[state.currentIdx]}: OK</p>`; }
        else { log.innerHTML = `<p style="color:#f472b6">${state.orders[state.currentIdx]}:</p>` + errs.map(e=>`<p>‚Ä¢ ${e}</p>`).join(''); }

        state.history.push({ name: state.orders[state.currentIdx], ok: errs.length===0 });
        state.currentIdx++;
        if(state.currentIdx >= state.orders.length) end("–í—Å—ë –º–µ–Ω—é –≥–æ—Ç–æ–≤–æ!");
        else loadOrder();
    }

    function startTimer() {
        state.interval = setInterval(() => {
            state.time--;
            let m=Math.floor(state.time/60), s=state.time%60;
            document.getElementById('timer').innerText = `${m}:${s<10?'0':''}${s}`;
            if(state.time <= 0) end("–í—Ä–µ–º—è –≤—ã—à–ª–æ!");
        }, 1000);
    }

    function end(msg) {
        clearInterval(state.interval);
        alert(`${msg}\n–†–µ–∑—É–ª—å—Ç–∞—Ç: ${state.score} –∏–∑ ${state.currentIdx}`);
        location.reload();
    }

    function setAttr(k,v,el) { state.build[k]=v; el.parentNode.querySelectorAll('.select-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }
    function addIng(n,v) { state.build.ing[n]=(state.build.ing[n]||0)+v; renderMix(); }
    function renderMix() { document.getElementById('current-mix').innerText = Object.entries(state.build.ing).map(([i,v])=>`${i}(${v})`).join(', ') || "–ü—É—Å—Ç–æ"; }
    function renderBottles(cat) { document.getElementById('bottles-grid').innerHTML = ingredients[cat].map(i=>`<div class="bottle-card"><div style="font-size:9px">${i}</div><button class="pour-btn" onclick="addIng('${i}',10)">+10</button><button class="pour-btn" onclick="addIng('${i}',20)">+20</button></div>`).join(''); }
    function changeStep(s) { [1,2,3].forEach(n=>document.getElementById('step-'+n).classList.add('hidden')); document.getElementById('step-'+s).classList.remove('hidden'); }
    function resetMix() { state.build={ing:{}, glass:'', tool:''}; renderMix(); document.querySelectorAll('.select-btn').forEach(b=>b.classList.remove('active')); }
    function toggleHint() { const h=document.getElementById('hint-box'); h.style.display = h.style.display==='block'?'none':'block'; }
   function toggleMusic() { 
    const p = document.getElementById('audio-player');
    if (p.paused) {
        p.play().catch(err => {
            console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º:', err);
            alert('–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –º—É–∑—ã–∫–∏ –µ—â–µ —Ä–∞–∑ –¥–ª—è –∑–∞–ø—É—Å–∫–∞');
        });
    } else {
        p.pause();
    }
}
</script>
</body>
</html>
